!function(){"use strict";function e(e,t,n,i,d,a,l,s=1/0){i<1&&(i=1),d<1&&(d=1),a<1&&(a=1),l<1&&(l=1),s<1&&(s=1/0),0===l&&d!==l&&(l=d),0===a&&i!==a&&(a=i);const o=Math.max(Math.ceil(d/l),0),c=Math.max(Math.ceil(i/a),0),m=[];for(let e=0;e<o;e++)for(let i=0;i<c;i++)s>0&&(m.push({x:t+i*a,y:n+e*l,w:a,h:l}),s--);return{name:e,frames:m}}function t(e,t,n,i){const d={frames:{},meta:{app:"sprite-sheet-to-json",version:"1.0.0",image:t,format:"RGBA8888",size:{w:n,h:i},scale:"1"}};for(const t of e)for(const[e,{x:a,y:l,w:s,h:o}]of t.frames.entries())d.frames[`${t.name}-${e}`]={frame:{x:a,y:l,w:s,h:o},rotated:!1,trimmed:!1,spriteSourceSize:{x:a,y:l,w:s,h:o},sourceSize:{w:n,h:i}};return d}const n=new Map,i=document.createElement("canvas"),d=i.getContext("2d"),a=document.createElement("canvas"),l=a.getContext("2d"),s=document.getElementById("disp"),o=s.getContext("2d"),c=document.getElementById("browse");c.addEventListener("change",(async function(){const e=this.files[0],t=new Image;t.addEventListener("load",(function(){i.width=this.width,i.height=this.height,d.imageSmoothingEnabled=!1,d.drawImage(t,0,0),a.width=i.width,a.height=i.height,s.width=4*i.width,s.height=4*i.height,N()})),t.src=URL.createObjectURL(e)})),document.getElementById("view-json").addEventListener("click",(function(){const e=c.files.length>0?c.files[0].name:"",d=t(n.values(),e,i.width,i.height);x.value=JSON.stringify(d,null,2),w.style.visibility="visible"})),document.getElementById("save-json").addEventListener("click",(function(){const e=c.files.length>0?c.files[0].name:"",d=e.replace(/\.\w+/,".json"),a=t(n.values(),e,i.width,i.height),l=JSON.stringify(a,null,2);!function(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(d,l)}));const m=document.getElementById("anims");m.addEventListener("change",B);const u=document.getElementById("frames"),r=document.getElementById("add-anim");r.addEventListener("click",(function(){m.selectedIndex=-1,v.style.visibility="visible",b.style.visibility="visible",c.disabled=!0,m.disabled=!0,u.disabled=!0,r.disabled=!0,h.disabled=!0,f.disabled=!0,g.disabled=!0,p()}));const h=document.getElementById("del-anim");h.addEventListener("click",(function(){const e=m.selectedIndex,t=m.options[m.selectedIndex];if(t){n.delete(t.text),t.remove(),l.clearRect(0,0,a.width,a.height),N();const i=m.options.length-1;m.selectedIndex=Math.min(e,i),B()}}));const f=document.getElementById("add-frame"),g=document.getElementById("del-frame"),v=document.getElementById("name-panel"),y=document.getElementById("name-text");y.addEventListener("focus",()=>y.select()),y.addEventListener("input",(function(){y.value=y.value.replace(/[^a-zA-Z0-9_-]/,"");const e=m.options[m.selectedIndex];if(e){const t=n.get(e.text);n.delete(t.name),t.name=y.value,e.text=y.value,n.set(t.name,t)}}));const b=document.getElementById("frames-panel"),E={x:document.getElementById("x"),y:document.getElementById("y"),w:document.getElementById("w"),h:document.getElementById("h"),frameW:document.getElementById("frame-w"),frameH:document.getElementById("frame-h"),frameCount:document.getElementById("frame-count")};Object.values(E).forEach(e=>{e.addEventListener("focus",()=>e.select()),e.addEventListener("input",p)}),document.getElementById("create").addEventListener("click",(function(){k();const t=e(y.value,Number(E.x.value),Number(E.y.value),Number(E.w.value),Number(E.h.value),Number(E.frameW.value),Number(E.frameH.value),Number(E.frameCount.value));n.set(t.name,t);const i=document.createElement("option");i.text=t.name,m.add(i),m.selectedIndex=i.index,B()})),document.getElementById("cancel").addEventListener("click",(function(){k(),l.clearRect(0,0,a.width,a.height),N()}));const w=document.getElementById("json-div"),I=document.getElementById("json-fade"),x=document.getElementById("json-text");function B(){const e=m.options[m.selectedIndex];e?(v.style.visibility="visible",y.value=e.text,L(n.get(e.text))):v.style.visibility="hidden"}function p(){for(const e in E){const t=E[e];t.value=t.value.replace(/[^0-9]/,"")}for(const e of["x","w","frameW"]){const t=E[e];t.value=Math.min(t.value,i.width)}for(const e of["y","h","frameH"]){const t=E[e];t.value=Math.min(t.value,i.height)}L(e(y.value,Number(E.x.value),Number(E.y.value),Number(E.w.value),Number(E.h.value),Number(E.frameW.value),Number(E.frameH.value),Number(E.frameCount.value)))}function L(e){l.clearRect(0,0,a.width,a.height);for(const t of e.frames)l.imageSmoothingEnabled=!1,l.lineWidth=1,l.strokeStyle="black",l.translate(.5,.5),l.strokeRect(t.x,t.y,t.w-1,t.h-1),l.setTransform(1,0,0,1,0,0);N()}function N(){o.clearRect(0,0,s.width,s.height),o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,i.width,i.height,0,0,s.width,s.height),o.drawImage(a,0,0,a.width,a.height,0,0,s.width,s.height)}function k(){v.style.visibility="hidden",b.style.visibility="hidden",c.disabled=!1,m.disabled=!1,u.disabled=!1,r.disabled=!1,h.disabled=!1,f.disabled=!1,g.disabled=!1}I.addEventListener("click",(function(){w.style.visibility="hidden"}))}();
//# sourceMappingURL=bundle.js.map
